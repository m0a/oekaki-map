# Feature Specification: Compact Toolbar Design

**Feature Branch**: `005-compact-toolbar`
**Created**: 2026-01-03
**Status**: Draft
**Input**: User description: "スクリーンショットを参照して欲しいんですがメニューが肥大化してきて描画エリアが狭くなってきているので綺麗に作りたい"

## Problem Statement

現在のツールバーは画面下部に固定表示されており、以下の問題があります：

1. **テキストラベルによるスペース消費**: 「Draw」「Erase」「Move」「Layers」「Undo」「Redo」などのテキストが大きなスペースを占有
2. **要素の横並び展開**: すべての要素が一度に表示されるため、画面幅を大きく使用
3. **描画エリアの圧迫**: 特にモバイル端末で描画エリアが狭くなっている

## Solution Approach

**アイコンベースのコンパクトUI**に置き換えることで、シンプルかつ効果的にスペースを節約します：

| 現在 | 変更後 |
| ---- | ------ |
| `↩ Undo` | ↩ (アイコンのみ) |
| `Redo ↪` | ↪ (アイコンのみ) |
| `Draw` | 鉛筆アイコン |
| `Erase` | 消しゴムアイコン |
| `Move` | 手のひらアイコン |
| `Layers` | レイヤーアイコン |

## User Scenarios & Testing *(mandatory)*

### User Story 1 - アイコンベースのコンパクトツールバー (Priority: P1)

ユーザーはアイコンで表現されたコンパクトなツールバーを使用して、より広い描画エリアで作業できます。各アイコンは直感的で、長押しまたはホバーでツールチップが表示されます。

**Why this priority**: テキストをアイコンに置き換えるだけで大幅なスペース削減が可能であり、最小限の変更で最大の効果が得られます。

**Independent Test**: ツールバーを確認し、すべてのボタンがアイコン表示になっていることを確認。各アイコンをタップして機能が正常に動作することを確認できます。

**Acceptance Scenarios**:

1. **Given** ツールバーが表示された状態、**When** ツールバーを確認、**Then** すべてのモードボタンがテキストではなくアイコンで表示されている
2. **Given** アイコンボタンが表示された状態、**When** アイコンを長押し（またはホバー）、**Then** ツール名がツールチップで表示される
3. **Given** ツールバーが表示された状態、**When** 各アイコンをタップ、**Then** 対応する機能が正常に動作する

---

### User Story 2 - カラーパレットのポップアップ表示 (Priority: P2)

ユーザーは現在選択中の色を示す小さなボタンをタップすると、カラーパレットがポップアップで表示され、色を選択できます。選択後はポップアップが自動的に閉じます。

**Why this priority**: 8色すべてを常時表示する代わりに、選択中の1色のみ表示することでスペースを大幅に節約できます。

**Independent Test**: 色ボタンをタップしてパレットが表示され、色を選択してパレットが閉じることを確認できます。

**Acceptance Scenarios**:

1. **Given** ツールバーが表示された状態、**When** 現在の色ボタンをタップ、**Then** 8色のカラーパレットがポップアップ表示される
2. **Given** カラーパレットが表示された状態、**When** 色を選択、**Then** 色が変更されポップアップが閉じる
3. **Given** カラーパレットが表示された状態、**When** パレット外をタップ、**Then** ポップアップが閉じる（色は変更されない）

---

### User Story 3 - 線の太さのポップアップ表示 (Priority: P2)

ユーザーは現在選択中の太さを示す小さなボタンをタップすると、太さ選択がポップアップで表示されます。

**Why this priority**: カラーパレットと同様に、太さ選択もポップアップ化することで一貫したUIとスペース節約を実現します。

**Independent Test**: 太さボタンをタップしてポップアップが表示され、太さを選択できることを確認できます。

**Acceptance Scenarios**:

1. **Given** ツールバーが表示された状態、**When** 太さボタンをタップ、**Then** 3つの太さオプションがポップアップ表示される
2. **Given** 太さポップアップが表示された状態、**When** 太さを選択、**Then** 太さが変更されポップアップが閉じる

---

### Edge Cases

- ポップアップ表示中に別のポップアップトリガーをタップした場合、現在のポップアップが閉じて新しいポップアップが開く
- 画面回転時にポップアップが開いていた場合、ポップアップは閉じる
- 非常に小さい画面（幅320px以下）でもツールバーは1行に収まる
- アイコンの意味が分からないユーザー向けに、長押しでツールチップを表示

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: モード切り替えボタン（Draw, Erase, Move, Layers）はアイコンで表示しなければならない
- **FR-002**: Undo/Redoボタンはテキストを削除し、矢印アイコンのみで表示しなければならない
- **FR-003**: カラーパレットは現在選択中の色を示すボタンとポップアップで表示しなければならない
- **FR-004**: 線の太さ選択は現在選択中の太さを示すボタンとポップアップで表示しなければならない
- **FR-005**: 各アイコンボタンは長押し（モバイル）またはホバー（デスクトップ）でツールチップを表示しなければならない
- **FR-006**: ポップアップは画面外タップまたは選択完了時に自動的に閉じなければならない
- **FR-007**: 現在のツールバーの全機能（8色、3太さ、4モード、Undo/Redo、共有、現在位置）は引き続きアクセス可能でなければならない

### アイコン定義

| 機能 | アイコン説明 | ツールチップ |
| ---- | ------------ | ------------ |
| Draw | 鉛筆 | 描画 |
| Erase | 消しゴム | 消去 |
| Move | 手のひら（パン） | 移動 |
| Layers | 重なった四角形 | レイヤー |
| Undo | 左向き矢印 | 元に戻す |
| Redo | 右向き矢印 | やり直し |
| Share | 共有アイコン（既存） | 共有 |
| Location | クロスヘア（既存） | 現在位置 |

### Key Entities

- **PopupType**: 現在表示中のポップアップの種類（none, color, thickness）
- **DrawingContext**: 現在の描画設定（色、太さ、モード）

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ツールバーの横幅が現在の50%以下に削減される
- **SC-002**: ツールバーの高さが現在の70%以下に削減される
- **SC-003**: 色またはサイズの変更は最大2タップで完了できる（1. ボタンタップ→2. 選択）
- **SC-004**: モバイル端末（幅375px）でツールバーが1行に収まる
- **SC-005**: 既存の全機能へのアクセスが維持される（機能の削除なし）
- **SC-006**: 各アイコンの意味がツールチップで確認できる

## Assumptions

- ユーザーは一般的なアイコン（鉛筆＝描画、消しゴム＝消去など）を理解している
- ツールチップは初回ユーザーや不明な場合のサポートとして十分
- 既存のアクセシビリティ対応（aria-label等）は維持・強化する
- SVGアイコンを使用してスケーラビリティを確保する

## Scope

### In Scope
- テキストラベルからアイコンへの置き換え
- カラーパレットのポップアップ表示
- 線の太さ選択のポップアップ表示
- ツールチップの実装
- タッチ操作に最適化されたUI

### Out of Scope
- ツールバーの折りたたみ/展開機能（将来の拡張として検討可能）
- ツールバーの位置変更（上部、左右への移動）
- ツールバーのカスタマイズ機能（ユーザーによるツール配置変更）
- カスタムアイコンのアップロード機能
